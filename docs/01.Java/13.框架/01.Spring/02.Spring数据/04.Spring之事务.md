---
title: Spring 之事务
date: 2022-09-22 07:46:49
categories:
  - Java
  - 框架
  - Spring
  - Spring数据
tags:
  - Java
  - 框架
  - Spring
  - SpringBoot
  - 事务
permalink: /pages/128c54/
---

# Spring 之事务

 Spring 框架为事务管理提供了一致的抽象，具有以下好处：

- 跨不同事务 API 的一致编程模型，例如 Java Transaction API (JTA)、JDBC、Hibernate 和 Java Persistence API (JPA)。
- 支持声明式事务管理。
- 用于编程事务管理的 API 比复杂事务 API（如 JTA）更简单。
- 与 Spring 的数据访问抽象完美集成。

## Spring 框架的事务支持模型的优点

传统上 Java EE 开发对事务管理有两种选择：全局事务或本地事务，两者都有很大的局限性。

### 全局事务

全局事务允许您使用多个事务资源，通常是关系数据库和消息队列。应用服务器通过 JTA 管理全局事务，这是一个繁琐的 API（部分原因在于其异常模型）。此外，JTA UserTransaction 通常需要来自 JNDI，这意味着您还需要使用 JNDI 才能使用 JTA。全局事务的使用限制了应用程序代码的任何潜在重用，因为 JTA 通常仅在应用程序服务器环境中可用。

以前，使用全局事务的首选方式是通过 EJB CMT（容器管理事务）。 CMT 是一种声明式事务管理（不同于程序化事务管理）。 EJB CMT 消除了对与事务相关的 JNDI 查找的需要，尽管使用 EJB 本身就需要使用 JNDI。它消除了大部分（但不是全部）编写 Java 代码来控制事务的需要。显着的缺点是 CMT 与 JTA 和应用程序服务器环境相关联。此外，它仅在选择在 EJB 中实现业务逻辑（或至少在事务性 EJB 外观之后）时才可用。一般来说，EJB 的负面影响是如此之大，以至于这不是一个有吸引力的提议，尤其是在面对声明式事务管理的引人注目的替代方案时。

### 本地事务

本地事务是指定资源的，例如与 JDBC 连接关联的事务。本地事务可能更容易使用，但有一个明显的缺点：它们不能跨多个事务资源工作。例如，使用 JDBC 连接管理事务的代码不能在全局 JTA 事务中运行。因为应用服务器不参与事务管理，它不能帮助确保跨多个资源的正确性。 （值得注意的是，大多数应用程序使用单个事务资源。）另一个缺点是本地事务对编程模型具有侵入性。



了解 Spring Framework 事务抽象概述了核心类，并描述了如何从各种来源配置和获取 DataSource 实例。

将资源与事务同步描述了应用程序代码如何确保正确地创建、重用和清理资源。

声明式事务管理描述了对声明式事务管理的支持。

程序化事务管理涵盖对程序化（即显式编码）事务管理的支持。

事务绑定事件描述了如何在事务中使用应用程序事件。

本章还讨论了最佳实践、应用服务器集成和常见问题的解决方案。



Spring 事务抽象的关键是事务策略的概念。事务策略由 `TransactionManager` 定义，特别是用于命令式事务管理的 `org.springframework.transaction.PlatformTransactionManager` 接口和用于响应式事务管理的 `org.springframework.transaction.ReactiveTransactionManager` 接口。

![](https://raw.githubusercontent.com/dunwu/images/dev/snap/20220922073737.png)

## 参考资料

- [Spring 官网](https://spring.io/)
- [Spring Framework 官方文档](https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/index.html)
- [Spring Boot 官方文档](https://docs.spring.io/spring-boot/docs/current/reference/html/data.html)
